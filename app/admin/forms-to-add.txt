// ADD THESE TWO COMPONENTS AT THE END OF app/admin/page.tsx (after line 2647, before the final closing brace)

// Stat Edit Form Component
function StatEditForm({
  stat,
  onSave,
  onCancel,
  onDelete,
  saving,
  deleting,
  successMessage
}: {
  stat: Stat | null
  onSave: (updates: Omit<Stat, 'id' | 'created_at' | 'updated_at'>) => void | Promise<void>
  onCancel?: () => void
  onDelete?: () => void
  saving: boolean
  deleting?: boolean
  successMessage?: string
}) {
  const [label, setLabel] = useState(stat?.label || '')
  const [value, setValue] = useState(stat?.value || '')
  const [title, setTitle] = useState(stat?.title || '')
  const [description, setDescription] = useState(stat?.description || '')
  const [mediaUrls, setMediaUrls] = useState<string[]>(stat?.media_urls || [])
  const [category, setCategory] = useState<'general' | 'culinary' | 'crew' | null>(stat?.category || 'general')
  const [orderIndex, setOrderIndex] = useState(stat?.order_index?.toString() || '0')
  const [isActive, setIsActive] = useState(stat?.is_active ?? true)

  useEffect(() => {
    if (stat) {
      setLabel(stat.label || '')
      setValue(stat.value || '')
      setTitle(stat.title || '')
      setDescription(stat.description || '')
      setMediaUrls(stat.media_urls || [])
      setCategory(stat.category || 'general')
      setOrderIndex(stat.order_index?.toString() || '0')
      setIsActive(stat.is_active ?? true)
    }
  }, [stat])

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault()
    onSave({
      label,
      value,
      icon: stat?.icon || null,
      title: title || null,
      description: description || null,
      media_urls: mediaUrls,
      category,
      order_index: parseInt(orderIndex) || 0,
      is_active: isActive,
    })
  }

  const handleRemoveMedia = (indexToRemove: number) => {
    setMediaUrls(prev => prev.filter((_, index) => index !== indexToRemove))
  }

  const handleAddUrl = () => {
    const url = prompt('Enter image or YouTube URL:')
    if (url && url.trim()) {
      setMediaUrls(prev => [...prev, url.trim()])
    }
  }

  const isCreateMode = !stat

  return (
    <div className="border border-gray-200 rounded-lg p-6">
      <div className="flex items-start justify-between mb-4">
        <h3 className="text-lg font-semibold text-gray-800">
          {isCreateMode ? 'Create New Stat' : stat.label}
        </h3>
        {!isCreateMode && onDelete && (
          <button
            type="button"
            onClick={onDelete}
            disabled={deleting}
            className="px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
          >
            {deleting ? 'Deleting...' : 'Delete'}
          </button>
        )}
      </div>

      {successMessage && (
        <div className="mb-4 p-3 bg-green-50 border border-green-200 rounded-lg">
          <p className="text-green-800 text-sm">{successMessage}</p>
        </div>
      )}

      <form onSubmit={handleSubmit} className="space-y-4">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Label *
            </label>
            <input
              type="text"
              value={label}
              onChange={(e) => setLabel(e.target.value)}
              required
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luxury-blue focus:border-transparent"
              placeholder="e.g., Years Experience"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Value *
            </label>
            <input
              type="text"
              value={value}
              onChange={(e) => setValue(e.target.value)}
              required
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luxury-blue focus:border-transparent"
              placeholder="e.g., 20+"
            />
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Category
          </label>
          <select
            value={category || 'general'}
            onChange={(e) => setCategory(e.target.value as 'general' | 'culinary' | 'crew' | null)}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luxury-blue focus:border-transparent"
          >
            <option value="general">General</option>
            <option value="culinary">Culinary</option>
            <option value="crew">Crew</option>
          </select>
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Title (Optional - for Culinary/Crew)
          </label>
          <input
            type="text"
            value={title || ''}
            onChange={(e) => setTitle(e.target.value)}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luxury-blue focus:border-transparent"
            placeholder="Extended title"
          />
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Description (Optional - for Culinary/Crew)
          </label>
          <textarea
            value={description || ''}
            onChange={(e) => setDescription(e.target.value)}
            rows={4}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luxury-blue focus:border-transparent"
            placeholder="Long description..."
          />
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Media URLs (Images/YouTube)
          </label>
          {mediaUrls.length > 0 && (
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
              {mediaUrls.map((url, index) => (
                <div key={index} className="relative">
                  {url.includes('youtube.com') || url.includes('youtu.be') ? (
                    <div className="aspect-video bg-gray-200 rounded flex items-center justify-center p-2">
                      <p className="text-xs text-gray-600 text-center">YouTube Video</p>
                    </div>
                  ) : (
                    <img src={url} alt={`Media ${index + 1}`} className="w-full h-24 object-cover rounded" />
                  )}
                  <button
                    type="button"
                    onClick={() => handleRemoveMedia(index)}
                    className="absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs"
                  >
                    Ã—
                  </button>
                </div>
              ))}
            </div>
          )}
          <button
            type="button"
            onClick={handleAddUrl}
            className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
          >
            + Add Image/Video URL
          </button>
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Order Index
            </label>
            <input
              type="number"
              value={orderIndex}
              onChange={(e) => setOrderIndex(e.target.value)}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luxury-blue focus:border-transparent"
            />
          </div>
          <div className="flex items-center gap-4 pt-6">
            <label className="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                checked={isActive}
                onChange={(e) => setIsActive(e.target.checked)}
                className="w-5 h-5 text-luxury-blue rounded focus:ring-luxury-blue"
              />
              <span className="text-sm font-medium text-gray-700">Active</span>
            </label>
          </div>
        </div>

        <div className="flex gap-4">
          <button
            type="submit"
            disabled={saving}
            className="px-6 py-2 bg-luxury-blue text-white rounded-lg font-semibold hover:bg-opacity-90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {saving ? 'Saving...' : isCreateMode ? 'Create Stat' : 'Save Changes'}
          </button>
          {isCreateMode && onCancel && (
            <button
              type="button"
              onClick={onCancel}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
          )}
        </div>
      </form>
    </div>
  )
}

// Review Edit Form Component
function ReviewEditForm({
  review,
  onSave,
  onCancel,
  onDelete,
  saving,
  deleting,
  successMessage
}: {
  review: Review | null
  onSave: (updates: Omit<Review, 'id' | 'created_at' | 'updated_at'>) => void | Promise<void>
  onCancel?: () => void
  onDelete?: () => void
  saving: boolean
  deleting?: boolean
  successMessage?: string
}) {
  const [guestName, setGuestName] = useState(review?.guest_name || '')
  const [guestLocation, setGuestLocation] = useState(review?.guest_location || '')
  const [rating, setRating] = useState(review?.rating?.toString() || '5')
  const [reviewText, setReviewText] = useState(review?.review_text || '')
  const [reviewDate, setReviewDate] = useState(review?.review_date || new Date().toISOString().split('T')[0])
  const [profileImageUrl, setProfileImageUrl] = useState(review?.profile_image_url || '')
  const [isFeatured, setIsFeatured] = useState(review?.is_featured ?? false)
  const [isApproved, setIsApproved] = useState(review?.is_approved ?? true)

  useEffect(() => {
    if (review) {
      setGuestName(review.guest_name || '')
      setGuestLocation(review.guest_location || '')
      setRating(review.rating?.toString() || '5')
      setReviewText(review.review_text || '')
      setReviewDate(review.review_date || new Date().toISOString().split('T')[0])
      setProfileImageUrl(review.profile_image_url || '')
      setIsFeatured(review.is_featured ?? false)
      setIsApproved(review.is_approved ?? true)
    }
  }, [review])

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault()
    onSave({
      guest_name: guestName,
      guest_location: guestLocation || null,
      rating: parseInt(rating) || 5,
      review_text: reviewText,
      review_date: reviewDate || null,
      profile_image_url: profileImageUrl || null,
      yacht_id: review?.yacht_id || null,
      is_featured: isFeatured,
      is_approved: isApproved,
    })
  }

  const isCreateMode = !review

  return (
    <div className="border border-gray-200 rounded-lg p-6">
      <div className="flex items-start justify-between mb-4">
        <h3 className="text-lg font-semibold text-gray-800">
          {isCreateMode ? 'Create New Review' : review.guest_name}
        </h3>
        {!isCreateMode && onDelete && (
          <button
            type="button"
            onClick={onDelete}
            disabled={deleting}
            className="px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
          >
            {deleting ? 'Deleting...' : 'Delete'}
          </button>
        )}
      </div>

      {successMessage && (
        <div className="mb-4 p-3 bg-green-50 border border-green-200 rounded-lg">
          <p className="text-green-800 text-sm">{successMessage}</p>
        </div>
      )}

      <form onSubmit={handleSubmit} className="space-y-4">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Customer Name *
            </label>
            <input
              type="text"
              value={guestName}
              onChange={(e) => setGuestName(e.target.value)}
              required
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luxury-blue focus:border-transparent"
              placeholder="John Doe"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Location (Optional)
            </label>
            <input
              type="text"
              value={guestLocation}
              onChange={(e) => setGuestLocation(e.target.value)}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luxury-blue focus:border-transparent"
              placeholder="New York, USA"
            />
          </div>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Rating (1-5 stars) *
            </label>
            <select
              value={rating}
              onChange={(e) => setRating(e.target.value)}
              required
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luxury-blue focus:border-transparent"
            >
              <option value="1">1 Star</option>
              <option value="2">2 Stars</option>
              <option value="3">3 Stars</option>
              <option value="4">4 Stars</option>
              <option value="5">5 Stars</option>
            </select>
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Review Date *
            </label>
            <input
              type="date"
              value={reviewDate || ''}
              onChange={(e) => setReviewDate(e.target.value)}
              required
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luxury-blue focus:border-transparent"
            />
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Profile Image/Avatar URL (Optional)
          </label>
          <input
            type="url"
            value={profileImageUrl}
            onChange={(e) => setProfileImageUrl(e.target.value)}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luxury-blue focus:border-transparent"
            placeholder="https://example.com/avatar.jpg"
          />
          {profileImageUrl && (
            <img src={profileImageUrl} alt="Profile preview" className="mt-2 w-20 h-20 rounded-full object-cover border border-gray-200" />
          )}
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Review Text *
          </label>
          <textarea
            value={reviewText}
            onChange={(e) => setReviewText(e.target.value)}
            required
            rows={6}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-luxury-blue focus:border-transparent"
            placeholder="Write the review text here..."
          />
        </div>

        <div className="flex items-center gap-6">
          <label className="flex items-center gap-2 cursor-pointer">
            <input
              type="checkbox"
              checked={isFeatured}
              onChange={(e) => setIsFeatured(e.target.checked)}
              className="w-5 h-5 text-luxury-blue rounded focus:ring-luxury-blue"
            />
            <span className="text-sm font-medium text-gray-700">Featured</span>
          </label>
          <label className="flex items-center gap-2 cursor-pointer">
            <input
              type="checkbox"
              checked={isApproved}
              onChange={(e) => setIsApproved(e.target.checked)}
              className="w-5 h-5 text-luxury-blue rounded focus:ring-luxury-blue"
            />
            <span className="text-sm font-medium text-gray-700">Approved</span>
          </label>
        </div>

        <div className="flex gap-4">
          <button
            type="submit"
            disabled={saving}
            className="px-6 py-2 bg-luxury-blue text-white rounded-lg font-semibold hover:bg-opacity-90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {saving ? 'Saving...' : isCreateMode ? 'Create Review' : 'Save Changes'}
          </button>
          {isCreateMode && onCancel && (
            <button
              type="button"
              onClick={onCancel}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
          )}
        </div>
      </form>
    </div>
  )
}
